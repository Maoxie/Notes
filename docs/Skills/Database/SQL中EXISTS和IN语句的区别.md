# SQL中EXISTS和IN语句的区别

查询时执行流程不同，因此在不同情况下查询效率各有优劣。

## IN

确定给定的值是否与子查询或列表中的值相匹配。

IN在查询的时候：
- 首先查询子查询的表，
- 然后将内表和外表做一个笛卡尔积，
- 然后按照条件进行筛选。

相对内表比较小的时候，IN的速度较快。

## EXISTS

指定一个子查询，检测行的存在。

EXISTS在查询时：
- 首先，我们先查询的不是子查询的内容，而是查我们的主查询的表，
- 然后，根据表的每一条记录，执行EXISTS语句，依次去语句中的查询条件是否成立。
- 如果成立则返回true不成立则返回false。如果返回的是true的话，则该行结果保留，如果返回的是false的话，则删除该行，最后将得到的结果返回。

## 区别和应用场景

IN和EXISTS的区别: 
- 如果子查询得出的结果集记录较少，主查询中的表较大且又有索引时应该用in
- 反之如果外层的主查询记录较少，子查询中的表大，又有索引时使用exists。

其实我们区分IN和EXISTS主要是造成了驱动顺序的改变(这是性能变化的关键)，如果是EXISTS，那么以外层表为驱动表，先被访问，如果是IN，那么先执行子查询，所以我们会以驱动表的快速返回为目标，那么就会考虑到索引及结果集的关系了 ，另外IN时不对NULL进行处理。

IN是把外表和内表作HASH连接，而EXISTS是对外表作LOOP循环，每次LOOP循环再对内表进行查询。一直以来认为EXISTS比IN效率高的说法是不准确的。

## NOT IN 和NOT EXISTS

- 如果查询语句使用了NOT IN 那么内外表都进行全表扫描，没有用到索引; 
- 而NOT EXISTS 的子查询依然能用到表上的索引。

所以无论那个表大，用NOT EXISTS都比NOT IN要快。